<style>
body {
  padding-top: 100px; /* 60px to make the container go all the way to the bottom of the topbar */
}
</style>


<% 

    @sizes = [
      ["N/A","PETITE","XS","S","M"],
      ["L","XL","XXL","00","0"],
      ["1","2","3","4","4.5"],
      ["5","5.5","6","6.5","7"],
      ["7.5","8","8.5","9","9.5"],
      ["10","10.5","11","11.5","12"],
      ["12.5","13","13.5","14","14.5"],
      ["15","15.5","16","16.5","17"],
      ["17.5","18","18.5","19","19.5"],
      ["20","21","22","23","24"],
      ["25","26","27","28","29"],
      ["30","31","32","33","34"],
      ["35","36","37","38","39"],
      ["40","41","42","43","44"]
]

%>

<div class="container">

  <!-- Main hero unit for a primary marketing message or call to action -->
  <div align="center" class="media-heading">     
    <p class="our-story"><font size="8">Upload a Sale</font></p></div><br><br><hr>


<script>

function ignoreDrag(e) {
  e.originalEvent.stopPropagation();
  e.originalEvent.preventDefault();
}

function drop(e) {
  ignoreDrag(e);
  var dt = e.originalEvent.dataTransfer;
  var files = dt.files;

  if(dt.files.length > 0){
    var file = dt.files[0];
    alert(file.name);
  }
}


$(document).ready(function () {
  $('#_image_0_iframe').load(function() {
    var jsonResponse = JSON.parse($("#_image_0_iframe")[0].contentWindow.document.body.innerText);
    $('#image_0_key')[0].value = jsonResponse['key']
    if ($('#sale_image_uploader_image_1').val().length > 0) {
      $('#image_1_form').submit();
    } else {
      //submit sale form
    }
  });

  $('#_image_1_iframe').load(function() {
    var jsonResponse = JSON.parse($("#_image_1_iframe")[0].contentWindow.document.body.innerText);
    $('#image_1_key')[0].value = jsonResponse['key']
    if ($('#sale_image_uploader_image_2').val().length > 0) {
      $('#image_2_form').submit();
    } else {
      //submit sale form
    }
  });
  
  $('#_image_2_iframe').load(function() {
    var jsonResponse = JSON.parse($("#_image_2_iframe")[0].contentWindow.document.body.innerText);
    $('#image_2_key')[0].value = jsonResponse['key'];

    //submit sale form
  });


  $('#selectFiles').click(function() {
    $.each([0,1,2],function(i) {
      var fileElly = $('#sale_image_uploader_image_' + i);

      if (fileElly.val().length == 0) {
        fileElly.click();
        return false;
      }

      if (i==2) {
        fileElly.click();
      }
    });
  });
  
  $('#uploady').click(function() {
    $('#image_0_form').submit();
  });



});

function nextEmptyFileInput() {
  var fileInput;

    $.each([0,1,2],function(i) {
      fileInput = $('#sale_image_uploader_image_' + i);

      if (fileInput.val().length == 0) {
        return false;
      }
    });
    return fileInput;
}

$(function () {
    var dropZoneId = "dropzone";
    var buttonId = "clickHere";
    var mouseOverClass = "mouse-over";

    var dropZone = $("#" + dropZoneId);
    var ooleft = dropZone.offset().left;
    var ooright = dropZone.outerWidth() + ooleft;
    var ootop = dropZone.offset().top;
    var oobottom = dropZone.outerHeight() + ootop;

    document.getElementById(dropZoneId).addEventListener("dragover", function (e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.addClass(mouseOverClass);
        var x = e.pageX;
        var y = e.pageY;

      var inputFile = nextEmptyFileInput();        

        if (!(x < ooleft || x > ooright || y < ootop || y > oobottom)) {
            inputFile.offset({ top: y - 15, left: x - 100 });
        } else {
            inputFile.offset({ top: -400, left: -400 });
        }

    }, true);

    if (buttonId != "") {
        var clickZone = $("#" + buttonId);

        var oleft = clickZone.offset().left;
        var oright = clickZone.outerWidth() + oleft;
        var otop = clickZone.offset().top;
        var obottom = clickZone.outerHeight() + otop;

        $("#" + buttonId).mousemove(function (e) {

            var inputFile = nextEmptyFileInput();        
          
            var x = e.pageX;
            var y = e.pageY;
            if (!(x < oleft || x > oright || y < otop || y > obottom)) {
                inputFile.offset({ top: y - 15, left: x - 160 });
            } else {
                inputFile.offset({ top: -400, left: -400 });
            }
        });
    }

    document.getElementById(dropZoneId).addEventListener("drop", function (e) {
        $("#" + dropZoneId).removeClass(mouseOverClass);
    }, true);

})

</script>


<style>
    #dropzone input {
        /*Important*/
        position: absolute;
        /*Important*/
        cursor: pointer;
        left: 0px;
        top: 0px;
        opacity:0; 
    }

    /*Important*/
    #dropzone.mouse-over {
        border: 2px dashed rgba(0,0,0,.5);
        color: rgba(0,0,0,.5);
    }
</style>

<button id="uploady" class="btn btn-large btn-success submit">Upload</button>


<iframe name="_image_0_iframe" id="_image_0_iframe" width="0" height="0" border="0" style="width: 0; height: 0; border: none;"></iframe>
<iframe name="_image_1_iframe" id="_image_1_iframe" width="0" height="0" border="0" style="width: 0; height: 0; border: none;"></iframe>
<iframe name="_image_2_iframe" id="_image_2_iframe" width="0" height="0" border="0" style="width: 0; height: 0; border: none;"></iframe>


<%= hidden_field_tag "image_0_key" %>
<%= hidden_field_tag "image_1_key" %>
<%= hidden_field_tag "image_2_key" %>


  <div class="row-fluid">

    <div class="span2"></div>

    <div class="span6">
      <center>
        <div id="dropzone" class="hero-unit">
          <div id="clickHere">
            or click here..

<%= direct_upload_form_for @uploader_0, :html => { :target => "_image_0_iframe", :id => "image_0_form" } do |f| %>
  <%= f.file_field :image_0 %>
<% end %>

<%= direct_upload_form_for @uploader_1, :html => { :target => "_image_1_iframe", :id => "image_1_form" } do |f| %>
  <%= f.file_field :image_1 %>
<% end %>

<%= direct_upload_form_for @uploader_2, :html => { :target => "_image_2_iframe", :id => "image_2_form" } do |f| %>
  <%= f.file_field :image_2 %>
<% end %>



          </div>

        <center><h3>Drag and Drop</h3></center>

      </div><!-- End of hero -->
    </center>
    </div>


    <div class="span2">
      <br>
      <br>

      <center>
        <button class="btn btn-large btn-success submit" id="selectFiles">Select Files</button>
      </center>
    </div>



  </div><!-- End of row -->
  <div class="photo-upload">
    <ul class="thumbnails">
      <li>
      <a href="#" class="thumbnail">
        <img data-src="holder.js/260x180" alt="" style="width: 260px; height: 180px;" >
      </a>
      </li>
      <li>
      <a href="#" class="thumbnail">
        <img data-src="holder.js/260x180" alt="" style="width: 260px; height: 180px;" >
      </a>
      </li>
      <li>
      <a href="#" class="thumbnail">
        <img data-src="holder.js/260x180" alt="" style="width: 260px; height: 180px;" >
      </a>
      </li>
  </ul></div>
  <div align="center">
    <div class="row">
      <select>
        <option>Select Category</option>
        <option>Women's</option>
        <option>Men's</option>
        <option>Home</option>
        <option>Baby</option>
        <option>Pet</option>
      </select><br><br>
      <div class="input-prepend">
        <a href="store.html"><button class="btn" type="button">Store</button></a>
        <input class="span2" id="prependedInput" type="text"><br><br>
        <span class="add-on">Brand</span>
        <input class="span2" id="prependedInput" type="text" placeholder="E.G., John Varvatos"><br><br>
        <span class="add-on">Orig $</span>
        <input class="span2" id="prependedInput" type="text"> <br><br>
        <span class="add-on">Sale $</span>
        <input class="span2" id="prependedInput" type="text"><br><br>
        <span class="add-on">% Off</span>
        <input class="span2" id="prependedInput" type="text"><br><br>
        <span class="add-on">Product</span>
        <input class="span2" id="prependedInput" type="text" placeholder="E.G., Wool Sweater"><br><br>		
      </div>
      <div id="hear">
        Select Sizes<br>
        <div class="" id="" style="width: 400px;">
          <style>
table#sizechart td {
  border-bottom: 1px solid rgb(221, 221, 221);
  text-align: center;
  cursor: pointer;
}
td.selectedSize {
  color: white;
  background-color: rgb(67, 17, 96);
}
          </style>

          <script>
selectedSizes = []

function selectSize(size_id) {
  var sizeTd = $('#'+size_id)[0];
  if (sizeTd.className == "selectedSize") {
    sizeTd.className = "";
  } else {
    sizeTd.className = "selectedSize";
  }

  selectedSizes = $('td.selectedSize').map(function(i,td) { return td.attributes['thesize'].value })
  $('input#size')[0].value = selectedSizes.toArray().join(',');
}
          </script>

          <table class="table table-bordered table-condensed" id="sizechart">            
            <% @sizes.each_with_index do |size_row, row| %>
              <tr>
              <% size_row.each_with_index do |size, col|
                size_id = "size_#{row}_#{col}" %>
              <td theSize="<%= size %>" id="<%= size_id %>" onclick="selectSize('<%= size_id %>')">
                  <%= size %>
                </td>
              <% end %>
              </tr>
            <% end %>          
            </table>

          </div>

          <br>

          <%= hidden_field_tag "size", params[:size], :id => "size" %>

          <div class="postbtn">
            <center>
              <button class="btn btn-large btn-success submit span2">Post</button>
            </center>

          </div>
        </div>
      </div>
    </div>

    <br><br>
